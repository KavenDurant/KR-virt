/*
 * @Author: KavenDurant luojiaxin888@gmail.com
 * @Date: 2025-06-10 15:30:00
 * @Description: 集群初始化测试文档 - 测试步骤和说明
 */

# 集群初始化系统测试指南

## 测试环境设置

1. **启动开发服务器**
   ```bash
   cd /Users/luojiaxin/WebstormProjects/KR-virt
   npm run dev
   ```
   应用将在 `http://localhost:3005/` 启动

2. **模拟数据配置**
   - 当前已启用模拟数据模式（USE_MOCK_DATA = true）
   - 无需连接真实API即可测试完整流程

## 完整测试流程

### 第一步：应用启动检查
1. 访问 `http://localhost:3005/`
2. 应用会自动检查集群状态
3. 显示"正在启动应用..."加载屏幕
4. 由于模拟数据返回 `is_ready: false`，会自动跳转到集群初始化流程

### 第二步：一次性密码验证
1. 进入集群认证页面
2. 页面显示："请输入一次性密码以继续集群配置"
3. **测试密码：`testCluster`**
4. 输入正确密码后点击"验证"
5. 成功后跳转到集群配置页面

### 第三步：集群配置
1. 默认显示"创建集群"标签页
2. 可以选择"创建集群"或"加入集群"

#### 创建集群测试：
- **集群名称**：输入 `testCluster`
- **节点角色**：选择 `主节点 (Master)`
- **网络接口**：输入 `eth0`
- **存储类型**：选择 `本地存储`
- **描述**：输入 `测试集群`
- 点击"创建集群"按钮

#### 加入集群测试：
- **主节点IP地址**：输入 `192.168.1.100`
- **端口**：输入 `6443`
- **加入令牌**：输入 `test-join-token-123456`
- **描述**：输入 `测试工作节点`
- 点击"加入集群"按钮

### 第四步：处理进度
1. 提交配置后进入处理页面
2. 显示进度条和当前步骤
3. 模拟以下步骤（每2秒更新一次）：

**创建集群流程：**
- 初始化集群配置... (10%)
- 创建控制平面... (30%)
- 配置网络组件... (50%)
- 启动系统服务... (70%)
- 验证集群状态... (90%)
- 集群创建完成 (100%)

**加入集群流程：**
- 连接主节点... (15%)
- 验证加入令牌... (35%)
- 下载集群配置... (55%)
- 配置本地节点... (75%)
- 注册到集群... (95%)
- 加入集群完成 (100%)

### 第五步：完成流程
1. 进度达到100%时显示完成状态
2. 显示"集群创建/加入完成"
3. 2秒后自动跳转到登录页面

### 第六步：登录页面
1. 系统跳转到登录页面
2. 可以正常进行用户登录操作

## 错误处理测试

### 网络错误模拟
- 集群状态检查失败会自动进入初始化流程
- 配置提交失败会显示错误提示

### 处理错误模拟
- 处理页面有10%概率模拟错误
- 错误时显示重试按钮和返回配置按钮

## 测试要点验证

1. **✅ 应用启动时自动检查集群状态**
2. **✅ 集群未就绪时进入初始化流程**
3. **✅ 一次性密码验证功能**
4. **✅ 创建和加入集群配置界面**
5. **✅ 表单验证和错误提示**
6. **✅ 进度显示和步骤跟踪**
7. **✅ 完成后跳转到登录页面**
8. **✅ 错误处理和重试机制**

## 模拟数据配置

当前模拟数据设置：
- **集群状态**：`is_ready: false, is_creating: false, is_joining: false`
- **一次性密码**：`testCluster`
- **处理成功率**：90%（10%概率模拟错误）

## 切换到真实API

要切换到真实API，请修改：
```javascript
// src/services/cluster/index.ts
const USE_MOCK_DATA = false; // 改为 false
```

然后确保API端点 `http://192.168.1.187:8001/cluster/status` 可访问。
