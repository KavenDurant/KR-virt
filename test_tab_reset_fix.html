<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>标签页重置修复测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #1890ff;
            margin-bottom: 10px;
        }
        .test-button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-button:hover {
            background: #40a9ff;
        }
        .test-button.secondary {
            background: #52c41a;
        }
        .test-button.secondary:hover {
            background: #73d13d;
        }
        .test-button.warning {
            background: #faad14;
        }
        .test-button.warning:hover {
            background: #ffc53d;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            background: #fff2f0;
            border-color: #ffccc7;
            color: #ff4d4f;
        }
        .success {
            background: #f6ffed;
            border-color: #b7eb8f;
            color: #52c41a;
        }
        .warning {
            background: #fffbe6;
            border-color: #ffe58f;
            color: #d48806;
        }
        .current-state {
            background: #f0f2f5;
            border: 1px solid #d9d9d9;
            padding: 10px;
            border-radius: 4px;
            margin-top: 15px;
        }
        .scenario {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>主机详情标签页重置修复测试</h1>
        <p>这个测试页面用于验证主机详情标签页在侧边栏选择变化时是否正确重置到默认状态。</p>
        
        <div class="current-state">
            <strong>当前状态：</strong>
            <div id="current-state">
                选择的主机: <span id="selected-host">无</span><br>
                主机详情标签页: <span id="host-tab">basic</span>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">问题场景重现</div>
            <div class="scenario">
                <strong>问题场景：</strong><br>
                1. 选择 node155 主机，切换到"硬件信息"标签页<br>
                2. 选择 br0 网络设备（清空主机选择）<br>
                3. 再次选择 node155 主机<br>
                4. <strong>期望：</strong>显示"基本信息"标签页<br>
                5. <strong>修复前：</strong>仍显示"硬件信息"标签页
            </div>
            
            <button class="test-button" onclick="step1()">步骤1: 选择 node155 主机</button>
            <button class="test-button secondary" onclick="step2()">步骤2: 切换到"硬件信息"标签页</button>
            <button class="test-button warning" onclick="step3()">步骤3: 选择 br0 网络设备</button>
            <button class="test-button" onclick="step4()">步骤4: 再次选择 node155 主机</button>
            <button class="test-button" onclick="resetTest()">重置测试</button>
            
            <div id="scenario-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">测试1: 同一主机重新选择</div>
            <p>测试选择同一主机时标签页是否重置</p>
            <button class="test-button" onclick="testSameHostReselection()">测试同一主机重新选择</button>
            <div id="same-host-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">测试2: 不同主机切换</div>
            <p>测试切换到不同主机时标签页是否重置</p>
            <button class="test-button" onclick="testDifferentHostSwitch()">测试不同主机切换</button>
            <div id="different-host-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">测试3: 网络设备选择后重新选择主机</div>
            <p>测试选择网络设备后再选择主机时标签页是否重置</p>
            <button class="test-button" onclick="testNetworkToHostSwitch()">测试网络设备到主机切换</button>
            <div id="network-host-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // 模拟应用状态
        let appState = {
            selectedHost: null,
            selectedNetwork: null,
            hostDetailActiveTab: 'basic'
        };

        // 模拟修复后的逻辑
        function simulateHostSelection(hostName) {
            console.log(`选择主机: ${hostName}`);
            
            // 模拟修复后的逻辑：重置标签页到默认状态
            appState.selectedHost = hostName;
            appState.selectedNetwork = null;
            appState.hostDetailActiveTab = 'basic'; // 重置到默认标签页
            
            updateCurrentState();
            
            console.log(`主机详情标签页重置到: ${appState.hostDetailActiveTab}`);
        }

        function simulateNetworkSelection(networkName) {
            console.log(`选择网络设备: ${networkName}`);
            
            appState.selectedHost = null;
            appState.selectedNetwork = networkName;
            // 网络设备没有标签页状态
            
            updateCurrentState();
        }

        function simulateTabSwitch(tabKey) {
            if (appState.selectedHost) {
                console.log(`切换主机详情标签页到: ${tabKey}`);
                appState.hostDetailActiveTab = tabKey;
                updateCurrentState();
            }
        }

        function updateCurrentState() {
            document.getElementById('selected-host').textContent = appState.selectedHost || '无';
            document.getElementById('host-tab').textContent = appState.hostDetailActiveTab;
        }

        // 问题场景重现步骤
        function step1() {
            simulateHostSelection('node155');
            showResult('scenario-result', 'success', '✅ 步骤1完成：选择了 node155 主机，标签页重置为"基本信息"');
        }

        function step2() {
            simulateTabSwitch('hardware');
            showResult('scenario-result', 'success', '✅ 步骤2完成：切换到"硬件信息"标签页');
        }

        function step3() {
            simulateNetworkSelection('br0');
            showResult('scenario-result', 'success', '✅ 步骤3完成：选择了 br0 网络设备，清空了主机选择');
        }

        function step4() {
            simulateHostSelection('node155');
            
            if (appState.hostDetailActiveTab === 'basic') {
                showResult('scenario-result', 'success', 
                    '✅ 步骤4完成：再次选择 node155 主机，标签页正确重置为"基本信息"<br>' +
                    '🎉 修复成功！标签页状态管理正常工作');
            } else {
                showResult('scenario-result', 'error', 
                    '❌ 步骤4失败：标签页没有重置，仍然是"' + appState.hostDetailActiveTab + '"<br>' +
                    '🐛 这表明修复没有生效');
            }
        }

        function resetTest() {
            appState = {
                selectedHost: null,
                selectedNetwork: null,
                hostDetailActiveTab: 'basic'
            };
            updateCurrentState();
            hideAllResults();
            showResult('scenario-result', 'warning', '🔄 测试已重置，可以重新开始');
        }

        // 测试函数
        function testSameHostReselection() {
            // 选择主机并切换标签页
            simulateHostSelection('node155');
            simulateTabSwitch('performance');
            
            // 重新选择同一主机
            simulateHostSelection('node155');
            
            if (appState.hostDetailActiveTab === 'basic') {
                showResult('same-host-result', 'success', 
                    '✅ 测试通过：重新选择同一主机时，标签页正确重置为"基本信息"');
            } else {
                showResult('same-host-result', 'error', 
                    '❌ 测试失败：标签页没有重置，当前为"' + appState.hostDetailActiveTab + '"');
            }
        }

        function testDifferentHostSwitch() {
            // 选择第一个主机并切换标签页
            simulateHostSelection('node155');
            simulateTabSwitch('hardware');
            
            // 切换到不同主机
            simulateHostSelection('node156');
            
            if (appState.hostDetailActiveTab === 'basic') {
                showResult('different-host-result', 'success', 
                    '✅ 测试通过：切换到不同主机时，标签页正确重置为"基本信息"');
            } else {
                showResult('different-host-result', 'error', 
                    '❌ 测试失败：标签页没有重置，当前为"' + appState.hostDetailActiveTab + '"');
            }
        }

        function testNetworkToHostSwitch() {
            // 选择主机并切换标签页
            simulateHostSelection('node155');
            simulateTabSwitch('hardware');
            
            // 选择网络设备
            simulateNetworkSelection('br0');
            
            // 重新选择主机
            simulateHostSelection('node155');
            
            if (appState.hostDetailActiveTab === 'basic') {
                showResult('network-host-result', 'success', 
                    '✅ 测试通过：从网络设备切换回主机时，标签页正确重置为"基本信息"<br>' +
                    '这正是原问题场景，现在已修复！');
            } else {
                showResult('network-host-result', 'error', 
                    '❌ 测试失败：标签页没有重置，当前为"' + appState.hostDetailActiveTab + '"<br>' +
                    '这是原问题场景，修复可能没有生效');
            }
        }

        function showResult(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result ' + type;
            element.innerHTML = message;
        }

        function hideAllResults() {
            const results = document.querySelectorAll('.result');
            results.forEach(result => {
                result.style.display = 'none';
            });
        }

        // 初始化
        updateCurrentState();
    </script>
</body>
</html>
